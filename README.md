Введение

Настоящая работа посвящена разработке интеллектуальной системы
распознавания эмоций человека по изображению лица с использованием
методов глубокого обучения. Основной задачей является построение
модели, способной классифицировать эмоциональное состояние на
основе визуальных признаков лица в режиме реального времени.

Теоретические основы

В основе системы лежат сверточные нейронные сети (CNN),
предназначенные для обработки изображений. Использована
архитектура ResNet18, основанная на residual-блоках. Остаточные связи
описываются выражением:

y = F(x) + x

где F(x) — нелинейное преобразование входа x. Такая структура
позволяет эффективно обучать глубокие сети без деградации качества
при увеличении глубины.
Для преобразования выходов сети в вероятности используется функция
Softmax:

Softmax(z_i) = exp(z_i) / Σ_j exp(z_j)

Функция потерь CrossEntropy определяется как:

L = - Σ y_i log(p_i)

Архитектура системы

Система состоит из трёх основных компонентов: этапа обучения,
сохранённой модели и консольного приложения для инференса.
Обучение выполняется в среде разработки, после чего модель
сохраняется в файл формата .pth и используется приложением.
Блок-схема этапа обучения:

Загрузка данных → Аугментация → Resize 224x224 → Normalize →
ResNet18 → Loss (CrossEntropy) → Оптимизация (Adam) →
Сохранение лучшей модели
Блок-схема этапа инференса:

Загрузка модели → Получение изображения → Преобразование →
Передача в сеть → Softmax → Выбор max вероятности →
Вывод результата

Подробное описание алгоритма

Алгоритм обучения включает следующие этапы:
1. Инициализация модели ResNet18.
2. Замена последнего полносвязного слоя на слой из 7 нейронов.
3. Заморозка базовых слоёв и fine-tuning последнего блока.
4. Загрузка обучающих данных.
5. Применение аугментации (RandomFlip, Rotation).
6. Вычисление функции потерь.
7. Обратное распространение ошибки.
8. Обновление весов.
9. Сохранение модели с лучшей точностью.
   
Алгоритм инференса:
1. Загрузка сохранённой модели.
2. Перевод модели в режим eval().
3. Получение изображения (камера/файл).
4. Преобразование изображения в тензор.
5. Передача данных в сеть.
6. Вычисление вероятностей через Softmax.
7. Вывод класса с максимальной вероятностью.
   
Метрики качества

Для оценки использованы следующие метрики: Accuracy, Precision, Recall,
F1-score. Также построена матрица ошибок для анализа распределения
ошибок классификации. Итоговая точность модели превышает 65% на
тестовой выборке.

Инструкция по эксплуатации
1. Установить Python 3.10+.
2. Установить зависимости:
 pip install torch torchvision opencv-python scikit-learn
3. Разместить файл модели в директории проекта.
4. Запустить:
 python emotion_console_app.py
5. Для анализа изображения:
 python emotion_console_app.py image.jpg
В случае отсутствия камеры или модели предусмотрена обработка
ошибок с выводом соответствующего сообщения пользователю.

Всего в системе 4 скрипта:
1) train_model обучение и сохранение модели нейросети на базе ResNet18
2) evaluate_model тест модели и получение актуальных Accuracy, Confusion Matrix
3) emotion_model сама нейросеть
4) main Обеспечивает взаимодействие между пользователем и нейросетью

Best_in_betest_model.pth - наиболее успешная модель нейросети и по совместительству текущая используемая модель

Конечная точность во время обучения модели составила 91.83%

По итогам тестов скрпта evaluate_model модель нейросети имеет следующие харрактеристики
Test Accuracy: 40.47% 
Classification Report: precision recall f1-score support 
angry 0.32 0.28 0.30 958 
disgust 0.08 0.29 0.12 111 
fear 0.28 0.20 0.23 1024 
happy 0.56 0.57 0.57 1774 
neutral 0.46 0.29 0.35 1233 
sad 0.37 0.34 0.35 1247 
surprise 0.42 0.74 0.53 831 
accuracy 0.40 7178 
macro avg 0.35 0.39 0.35 7178 
weighted avg 0.41 0.40 0.40 7178 
Confusion Matrix: 
[[ 269 86 102 166 64 129 142]
[ 17 32 9 24 5 12 12]
[ 108 77 202 132 71 195 239]
[ 140 85 100 1019 114 164 152]
[ 124 42 104 219 352 204 188]
[ 152 75 149 213 124 419 115]
[ 30 17 53 58 38 23 612]]
